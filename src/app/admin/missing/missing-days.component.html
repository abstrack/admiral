<notification-bar></notification-bar>
<h3 style="text-align: center">ימים חסרים</h3>
<div class="container">
  <div class="row hebrew-direct">

    <div class="col-md-2 pull-left">
      <button class="btn btn-sm btn-default" (click)="openMissingMailDialog()"><i class="fa fa-envelope" aria-hidden="true"></i>&nbsp;דיוור</button>
      <button id="mailingFormOpen" [hidden]="true" data-toggle="modal" data-target="#mailingForm"></button>
    </div>
    <p-dropdown [options]="departmentsUi" [(ngModel)]="chosenDepartment" [filter]="true"
                (onChange)="getEmployeesUi(chosenDepartment)"></p-dropdown>
    <p-dropdown [options]="employeesUi" [(ngModel)]="chosenEmployee" [filter]="true"></p-dropdown>
    <div class="col-md-4">
      <p-selectButton [options]="types" [(ngModel)]="selectedType"></p-selectButton>
      <button class="btn btn-sm btn-default" (click)="missingDaysReport()"><i class="fa fa fa-save" aria-hidden="true"></i>&nbsp;הורדה</button>
    </div>
    <div class="col-md-2 pull-right">
      <button class="btn btn-sm btn-info" (click)="getMissedDays()"><i
        class="fa fa-chevron-circle-down" aria-hidden="true"></i>&nbsp;חפש&nbsp;</button>
    </div>
  </div>
</div>
<br>

<div *ngIf="tableVisible">
  <div class="ui-widget-header" style="padding:4px 10px;border-bottom: 0 none">
    <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
    <input #gb type="text" pInputText size="50" placeholder="חיפוש">
  </div>
  <p-dataTable emptyMessage="אין נתונים" [value]="infosUi" [globalFilter]="gb" sortMode="multiple" [style]="{'text-align':'center'}">
    <p-column field="date" header="תאריך" [sortable]="true"></p-column>
    <p-column field="departmentName" header="צוות" [sortable]="true"></p-column>
    <p-column field="employeeSurname" header="שם משפחה" [sortable]="true"></p-column>
    <p-column field="employeeName" header="שם" [sortable]="true"></p-column>
  </p-dataTable>
</div>

<div id="mailingForm" tabindex='-1' width="500" class="modal fade" onclose="" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header noselect" style="text-align: center">
        <a id="mailingFormClose" style="float: left" data-dismiss="modal"><span class="fa fa-fw fa-close"
                                                                                style="color: #1a1a1a; cursor: pointer; font-size: large"></span></a>
        <span class="work-infos-modal-title hebrew-direct">
      דיוור ימים חסרים
          <br>
          <span class="work-infos-modal-title-description hebrew-direct">
            {{mailingFrom | dateFormatPipe}} - {{mailingTo | dateFormatPipe}}
          </span>
        </span>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-2"></div>
          <div *ngIf="mailError" style="text-align: center" class="alert alert-danger col-md-8">
            {{mailError}}
          </div>
          <div class="col-md-2"></div>
        </div>
        <div class="row col-md-12 form-group">
          <div class="col-md-6 pull-left">
            <input type="email" [disabled]="!showReceiverEmail" placeholder="ד''א מסוים" [(ngModel)]="missingReportEmail" style="direction: ltr; text-align: center" class="form-control hebrew-direct">
          </div>
          <div class="col-md-1 pull-left">
              <p-checkbox id="specificEmail" [(ngModel)]="showReceiverEmail" binary="true"></p-checkbox>
          </div>
          <div class="col-md-4 pull-right hebrew-direct">
            <ss-multiselect-dropdown [options]="employeesCheckboxOptions"
                                     [texts]="employeesCheckboxTexts"
                                     [settings]="employeesCheckboxSettings"
                                     [(ngModel)]="employeeIds"></ss-multiselect-dropdown>
          </div>
        </div>
        <div class="row form-group">
          <div class="col-md-12">
            <textarea id="missingMailTextArea" [(ngModel)]="missingReportMessage" class="form-control hebrew-direct" placeholder="הודעה">רשימת ימים חסרים מ{{mailingFrom | dateFormatPipe}} עד {{mailingTo | dateFormatPipe}}. אנא למלא את שעות העבודה בימים האלה.</textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="ui-dialog-buttonpane ui-helper-clearfix">
          <button type="button" class="ui-button-danger pull-left" pButton icon="fa-close" (click)="closeMissingMailDialog()" label="בטל"></button>
          <button type="button" class="pull-left" pButton icon="fa-paper-plane" (click)="sendAndCloseMissingMailDialog(missingReportEmail, missingReportMessage)" label="שלח"></button>
        </div>
      </div>
    </div>
  </div>
</div>
